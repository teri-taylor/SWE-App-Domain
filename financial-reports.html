<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Financial Reports | SyncFinance</title>
  <!-- Base styles + manager report styles -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="manager-ui.css">

  <style>
    :root {
      --blue: #002D62;
      --jet: #333333;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f7fb;
      color: var(--jet);
    }

    /* Keep header white (not blue) */
    .main-header {
      background: white;
      color: var(--jet);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
    }

    .full-logo {
      height: 40px;
    }

    .user {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      position: relative;
    }

    .user img {
      height: 40px;
      width: 40px;
      border-radius: 50%;
    }

    .name-role p {
      margin: 0;
      line-height: 1.2;
    }

    .user-menu {
      position: absolute;
      top: 52px;
      right: 0;
      background: #ffffff;
      color: #000;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      padding: 8px;
      min-width: 120px;
      display: none;
      z-index: 20;
    }

    .user.open .user-menu {
      display: block;
    }

    .user-menu button {
      width: 100%;
      background: transparent;
      color: #111827;
      border: none;
      padding: 6px 8px;
      border-radius: 6px;
      text-align: left;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .user-menu button:hover {
      background: #e5e7eb;
    }

    /* Let reports-page from manager-ui.css handle the main layout */
    .reports-page {
      min-height: calc(100vh - 72px);
    }
  </style>
</head>
<body>
  <!-- Shared header -->
  <header class="main-header">
    <img src="./images/full-logo.png" alt="SyncFinance Logo" class="full-logo">

    <div class="user">
      <img src="./images/user-profile.png" alt="User Profile Logo">
      <div class="name-role">
        <p>Sample User</p>
        <p>Manager</p>
      </div>

      <div class="user-menu" id="user-menu" aria-hidden="true" role="menu">
        <button id="logout-btn" role="menuitem">Log out</button>
      </div>
    </div>
  </header>

  <!-- Financial reports content -->
  <main class="reports-page">
    <section class="reports-card">
      <h1>Financial Reports</h1>

      <form id="report-filters" class="reports-form">
        <!-- Row 1: Report type + date or date range -->
        <div class="form-row">
          <div class="form-group">
            <label for="reportType">Report Type</label>
            <select id="reportType">
              <option value="trialBalance">Trial Balance</option>
              <option value="incomeStatement">Income Statement</option>
              <option value="balanceSheet">Balance Sheet</option>
              <option value="retainedEarnings">Retained Earnings</option>
            </select>
          </div>

          <div class="form-group">
            <label for="reportDateFrom">From</label>
            <input type="date" id="reportDateFrom">
          </div>

          <div class="form-group">
            <label for="reportDateTo">To</label>
            <input type="date" id="reportDateTo">
          </div>
        </div>

        <!-- Row 2: Buttons -->
        <div class="button-row">
          <button type="button" id="generateBtn">Generate</button>
          <button type="button" id="saveBtn">Save</button>
          <button type="button" id="emailBtn">Email</button>
          <button type="button" id="printBtn">Print</button>
        </div>
      </form>

      <!-- Where the report table will show up -->
      <div id="report-output" class="report-output">
        <p class="placeholder-text">
          Select a report type and date range, then click <strong>Generate</strong>.
        </p>
      </div>
    </section>
  </main>

  <script>
    // ===== Profile menu + logout + session role/name =====
    (function () {
      function wireProfileMenu() {
        const user = document.querySelector(".user");
        if (!user) return;

        const menu = user.querySelector("#user-menu");
        const logoutBtn = user.querySelector("#logout-btn");

        user.addEventListener("click", () => {
          user.classList.toggle("open");
          if (menu) {
            menu.setAttribute(
              "aria-hidden",
              String(!user.classList.contains("open"))
            );
          }
        });

        document.addEventListener("click", (e) => {
          if (!user.contains(e.target)) {
            user.classList.remove("open");
            if (menu) menu.setAttribute("aria-hidden", "true");
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            user.classList.remove("open");
            if (menu) menu.setAttribute("aria-hidden", "true");
          }
        });

        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            localStorage.removeItem("sf_session");
            window.location.href = "login.html";
          });
        }

        // Fill from sf_session if present
        try {
          const session = JSON.parse(localStorage.getItem("sf_session") || "null");
          if (session) {
            const nameEl = user.querySelector(".name-role p:first-child");
            const roleEl = user.querySelector(".name-role p:last-child");
            if (nameEl && session.name) nameEl.textContent = session.name;
            if (roleEl && session.role) {
              roleEl.textContent =
                session.role.charAt(0).toUpperCase() + session.role.slice(1);
            }
          }
        } catch {}
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", wireProfileMenu);
      } else {
        wireProfileMenu();
      }
    })();
  </script>

  <script>
    // ===== Sample "fake" data for each report type (front-end only) =====
    const sampleReports = {
      trialBalance: {
        headers: ["Account", "Debit", "Credit"],
        rows: [
          ["Cash", "10,000", ""],
          ["Accounts Receivable", "5,000", ""],
          ["Revenue", "", "12,000"],
          ["Utilities Expense", "2,000", ""]
        ],
        footer: ["Totals", "17,000", "12,000"]
      },
      incomeStatement: {
        headers: ["Item", "Amount"],
        rows: [
          ["Sales Revenue", "50,000"],
          ["Cost of Goods Sold", "(30,000)"],
          ["Gross Profit", "20,000"],
          ["Operating Expenses", "(8,000)"]
        ],
        footer: ["Net Income", "12,000"]
      },
      balanceSheet: {
        headers: ["Item", "Amount"],
        rows: [
          ["Total Assets", "100,000"],
          ["Total Liabilities", "40,000"],
          ["Total Equity", "60,000"]
        ],
        footer: ["Assets = Liabilities + Equity", "100,000 = 40,000 + 60,000"]
      },
      retainedEarnings: {
        headers: ["Item", "Amount"],
        rows: [
          ["Beginning Retained Earnings", "25,000"],
          ["+ Net Income", "12,000"],
          ["- Dividends", "(3,000)"]
        ],
        footer: ["Ending Retained Earnings", "34,000"]
      }
    };

    // --- DOM elements ---
    const reportTypeSelect = document.getElementById("reportType");
    const dateFromInput = document.getElementById("reportDateFrom");
    const dateToInput = document.getElementById("reportDateTo");
    const generateBtn = document.getElementById("generateBtn");
    const saveBtn = document.getElementById("saveBtn");
    const emailBtn = document.getElementById("emailBtn");
    const printBtn = document.getElementById("printBtn");
    const reportOutput = document.getElementById("report-output");

    // --- Helper: build HTML table for a report ---
    function buildReportTable(reportData) {
      const { headers, rows, footer } = reportData;

      // Start table
      let html = '<table class="report-table"><thead><tr>';
      headers.forEach(h => {
        html += `<th>${h}</th>`;
      });
      html += "</tr></thead><tbody>";

      // Rows
      rows.forEach(row => {
        html += "<tr>";
        row.forEach(cell => {
          html += `<td>${cell}</td>`;
        });
        html += "</tr>";
      });

      html += "</tbody>";

      // Footer (totals, etc.)
      if (footer && footer.length) {
        html += "<tfoot><tr>";
        footer.forEach(cell => {
          html += `<td>${cell}</td>`;
        });
        html += "</tr></tfoot>";
      }

      html += "</table>";
      return html;
    }

    // --- Generate button click (front-end only) ---
    generateBtn.addEventListener("click", () => {
      const type = reportTypeSelect.value;
      const from = dateFromInput.value;
      const to = dateToInput.value;

      const reportData = sampleReports[type];

      if (!reportData) {
        reportOutput.innerHTML =
          '<p class="placeholder-text">No data found for this report type.</p>';
        return;
      }

      let headingText = "";
      switch (type) {
        case "trialBalance":
          headingText = "Trial Balance";
          break;
        case "incomeStatement":
          headingText = "Income Statement";
          break;
        case "balanceSheet":
          headingText = "Balance Sheet";
          break;
        case "retainedEarnings":
          headingText = "Retained Earnings Statement";
          break;
      }

      let dateText = "";
      if (from || to) {
        dateText = `<p><strong>Period:</strong> ${from || "N/A"} to ${to || "N/A"}</p>`;
      }

      const tableHtml = buildReportTable(reportData);

      reportOutput.innerHTML = `
        <h2>${headingText}</h2>
        ${dateText}
        ${tableHtml}
      `;
    });

    // --- Save button (front-end only placeholder) ---
    saveBtn.addEventListener("click", () => {
      alert(
        "Save feature will be implemented with the backend.\nFor Sprint 4, this is just a placeholder."
      );
    });

    // --- Email button (front-end only placeholder) ---
    emailBtn.addEventListener("click", () => {
      alert(
        "Email feature will be implemented with the backend.\nFor Sprint 4, this is just a placeholder."
      );
    });

    // --- Print button: just print the page for now ---
    printBtn.addEventListener("click", () => {
      window.print();
    });
  </script>
</body>
</html>

