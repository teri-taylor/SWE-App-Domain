<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body class="newuser-body">
  <div class="newuser-base">

    <!-- HEADER / LOGO -->
    <button type="button" id="login-header">
      <img src="./images/full-logo.png" alt="SyncFinance Logo" class="full-logo">
    </button>

    <div class="header">
      <h1>Forgot Password</h1>
    </div>

    <div class="main-content">

      <p style="text-align:center; max-width:540px; margin:0 auto;">
        Enter your User ID and Email, answer your security questions, 
        and create a new password.
      </p>

      <!-- USER ID + EMAIL -->
      <div class="user-info">
        <div class="new-input" style="display:flex; gap:10px; max-width:540px; margin:0 auto;">
          <input type="text" id="fp-userid" placeholder="User ID">
          <input type="email" id="fp-email" placeholder="Email Address">
        </div>
      </div>

      <!-- SECURITY QUESTIONS -->
      <div class="ans-security" style="max-width:540px; margin:20px auto 0;">
        <div class="security-questions new-input">
          <label for="answer-box-1">Security Question #1:</label>
          <input type="text" id="answer-box-1">
        </div>

        <div class="security-questions new-input">
          <label for="answer-box-2">Security Question #2:</label>
          <input type="text" id="answer-box-2">
        </div>

        <div class="security-questions new-input">
          <label for="answer-box-3">Security Question #3:</label>
          <input type="text" id="answer-box-3">
        </div>
      </div>

      <!-- PASSWORD REQUIREMENTS -->
      <div class="password-req">
        <p>Minimum Requirements</p>
        <p>Must start with a letter</p>
        <p>Must contain a letter</p>
        <p>Must contain a number</p>
        <p>Must contain a special character</p>
        <p>Must be at least 8 characters</p>
      </div>


      <!-- NEW PASSWORD -->
      <form id="forgot-pw-form" novalidate>
        <div class="create-password">
          <input type="password" id="fp-new-pass" placeholder="NEW PASSWORD">
          <p class="error-msg" id="fp-pw-error"></p>

          <input type="password" id="fp-confirm-pass" placeholder="CONFIRM PASSWORD">
          <p class="error-msg" id="fp-pw2-error"></p>
        </div>

        <div class="submit-btn">
          <button type="submit" class="nxt-btn">SUBMIT</button>
        </div>
      </form>

    </div>
  </div>

<script src="script.js"></script>
<script>
  // ======= PASSWORD VALIDATION FUNCTION =========
  function validatePassword(pw) {
    const startsWithLetter = /^[A-Za-z]/.test(pw);
    const hasLetter = /[A-Za-z]/.test(pw);
    const hasNumber = /\d/.test(pw);
    const hasSpecial = /[^A-Za-z0-9]/.test(pw);
    const longEnough = pw.length >= 8;

    return {
      valid: startsWithLetter && hasLetter && hasNumber && hasSpecial && longEnough,
      startsWithLetter,
      hasLetter,
      hasNumber,
      hasSpecial,
      longEnough
    };
  }



  // ========= Forgot Password Page Logic =========
function wireForgotPasswordPage() {
  const form = document.getElementById("forgot-pw-form");
  if (!form) return; // not on this page

  const userIdInput = document.getElementById("fp-userid");
  const emailInput = document.getElementById("fp-email");
  const ans1Input = document.getElementById("answer-box-1");
  const ans2Input = document.getElementById("answer-box-2");
  const ans3Input = document.getElementById("answer-box-3");

  const pwInput = document.getElementById("fp-new-pass");
  const pw2Input = document.getElementById("fp-confirm-pass");
  const pwError = document.getElementById("fp-pw-error");
  const pw2Error = document.getElementById("fp-pw2-error");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    // Clear previous error styles/messages
    [userIdInput, emailInput, ans1Input, ans2Input, ans3Input, pwInput, pw2Input].forEach(el => {
      if (!el) return;
      el.classList.remove("input-error");
    });
    if (pwError) { pwError.style.display = "none"; pwError.textContent = ""; }
    if (pw2Error) { pw2Error.style.display = "none"; pw2Error.textContent = ""; }

    let hasError = false;

    // Basic required field checks
    if (!userIdInput.value.trim()) {
      userIdInput.classList.add("input-error");
      hasError = true;
    }

    if (!emailInput.value.trim()) {
      emailInput.classList.add("input-error");
      hasError = true;
    }

    if (!ans1Input.value.trim()) {
      ans1Input.classList.add("input-error");
      hasError = true;
    }
    if (!ans2Input.value.trim()) {
      ans2Input.classList.add("input-error");
      hasError = true;
    }
    if (!ans3Input.value.trim()) {
      ans3Input.classList.add("input-error");
      hasError = true;
    }

    if (hasError) {
      alert("Please fill in all required fields.");
      return;
    }

    // Password validation based on Sprint 1 rules
    const result = validatePassword(pwInput.value);

    if (!result.valid) {
      pwInput.classList.add("input-error");
      if (pwError) {
        pwError.style.display = "block";
        pwError.textContent =
          "Password must start with a letter, include a letter, number, special character, and be at least 8 characters long.";
      }
      return;
    }

    if (pwInput.value !== pw2Input.value) {
      pw2Input.classList.add("input-error");
      if (pw2Error) {
        pw2Error.style.display = "block";
        pw2Error.textContent = "Passwords do not match.";
      }
      return;
    }

    // TODO: replace this with a real fetch() call to your backend later
    alert("If your information is correct, your password will be reset.");

    // e.g. later:
    // fetch("/api/forgot-password", { method:"POST", body: JSON.stringify({...}) })
  });
}

// Run this on every page; it will only activate if the form exists
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", wireForgotPasswordPage);
} else {
  wireForgotPasswordPage();
}

</script>
</body>
</html>
