<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expired Passwords Report | SyncFinance</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
  <header class="main-header">
    <img src="./images/full-logo.png" alt="SyncFinance Logo" class="full-logo">

    <div class="user">
      <img src="./images/user-profile.png" alt="User Profile Logo">
      <div class="name-role">
        <p>Jane Doe</p>
        <p>Administrator</p>
      </div>

      <div class="user-menu" id="user-menu" aria-hidden="true" role="menu">
        <button id="logout-btn" role="menuitem">Log out</button>
      </div>
    </div>
  </header>

  <main class="admin-container">
    <section class="page-title">
      <h1>Expired Passwords Report</h1>
      <p class="subtitle">
        Demo report of users whose passwords are expired or close to expiring.
      </p>
    </section>

    <section class="table-wrap">
      <table class="client-table password-table">
        <caption class="sr-only">Expired passwords for system users</caption>
        <thead>
          <tr>
            <th scope="col">User</th>
            <th scope="col">Role</th>
            <th scope="col">Last Password Change</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody id="passwordRows">
          <!-- Filled by JavaScript -->
        </tbody>
      </table>
    </section>
  </main>

  <script>
    // Simple profile menu + logout + name/role from sf_session
    (function () {
      function wireProfileMenu() {
        const user = document.querySelector(".user");
        if (!user) return;

        const menu = user.querySelector("#user-menu");
        const logoutBtn = user.querySelector("#logout-btn");

        user.addEventListener("click", () => {
          user.classList.toggle("open");
          if (menu) menu.setAttribute("aria-hidden", String(!user.classList.contains("open")));
        });

        document.addEventListener("click", (e) => {
          if (!user.contains(e.target)) {
            user.classList.remove("open");
            if (menu) menu.setAttribute("aria-hidden", "true");
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            user.classList.remove("open");
            if (menu) menu.setAttribute("aria-hidden", "true");
          }
        });

        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            localStorage.removeItem("sf_session");
            window.location.href = "login.html";
          });
        }

        // Fill from sf_session if present
        try {
          const session = JSON.parse(localStorage.getItem("sf_session") || "null");
          if (session) {
            const nameEl = user.querySelector(".name-role p:first-child");
            const roleEl = user.querySelector(".name-role p:last-child");
            if (nameEl && session.name) nameEl.textContent = session.name;
            if (roleEl && session.role) {
              roleEl.textContent = session.role.charAt(0).toUpperCase() + session.role.slice(1);
            }
          }
        } catch { }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", wireProfileMenu);
      } else {
        wireProfileMenu();
      }
    })();

    // === Demo expired-password data ===
    (function () {
      const USERS = [
        { name: "Alex Taylor", role: "Accountant", lastChange: "2025-01-10" },
        { name: "Jane Doe",   role: "Administrator", lastChange: "2024-12-01" },
        { name: "Mark Green", role: "Manager", lastChange: "2024-10-15" }
      ];

      function daysSince(dateStr) {
        const d = new Date(dateStr);
        if (isNaN(d)) return null;
        const ms = Date.now() - d.getTime();
        return Math.floor(ms / (1000 * 60 * 60 * 24));
      }

      const tbody = document.getElementById("passwordRows");
      if (!tbody) return;

      USERS.forEach(u => {
        const tr = document.createElement("tr");
        const days = daysSince(u.lastChange);
        let status = "Active";

        // You can tweak these thresholds to match your professorâ€™s rules
        if (days !== null) {
          if (days > 90) {
            status = "Expired";
          } else if (days > 60) {
            status = "Expiring Soon";
          }
        }

        tr.innerHTML = `
          <td>${u.name}</td>
          <td>${u.role.charAt(0).toUpperCase() + u.role.slice(1)}</td>
          <td>${u.lastChange}</td>
          <td>${status}</td>
        `;

        if (status === "Expired") {
          tr.classList.add("pw-expired");
        }

        tbody.appendChild(tr);
      });
    })();
  </script>
</body>
</html>
