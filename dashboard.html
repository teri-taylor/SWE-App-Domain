<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SyncFinance Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="manager-ui.css">
  <style>
    .dash-page {
      min-height: 100vh;
      background:#f5f7fb;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    .dash-layout {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 2fr 1.2fr;
      gap: 20px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .dash-layout { grid-template-columns: 1fr; }
    }

    .dash-card {
      background:#ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(15,23,42,0.08);
      padding: 20px 22px;
    }

    .dash-card h1,
    .dash-card h2 {
      margin: 0 0 10px;
    }

    .dash-subtitle {
      margin: 0 0 18px;
      font-size: 0.9rem;
      color:#6b7280;
    }

    .ratio-grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:12px;
    }

    .ratio-card {
      border-radius:12px;
      padding:12px 14px;
      border:1px solid #e5e7eb;
      background:#ffffff;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .ratio-label {
      font-size:0.85rem;
      font-weight:600;
      color:#111827;
    }

    .ratio-value {
      font-size:1.4rem;
      font-weight:700;
    }

    .ratio-tag {
      font-size:0.75rem;
      border-radius:999px;
      padding:3px 8px;
      align-self:flex-start;
      margin-top:2px;
    }

    .ratio-good {
      background:#dcfce7;
      color:#166534;
    }
    .ratio-warning {
      background:#fef9c3;
      color:#854d0e;
    }
    .ratio-bad {
      background:#fee2e2;
      color:#b91c1c;
    }

    .ratio-note {
      font-size:0.75rem;
      color:#6b7280;
      margin-top:4px;
    }

    .menu-links {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:12px;
    }

    .menu-links a {
      text-decoration:none;
      padding:8px 14px;
      border-radius:999px;
      font-size:0.85rem;
      border:1px solid #dbe3f3;
      color:#0f172a;
      background:#ffffff;
    }

    .menu-links a.primary-link {
      background:#0f172a;
      color:#ffffff;
      border-color:#0f172a;
    }

    .alerts-list {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size:0.9rem;
    }

    .alert-item {
      border-radius:10px;
      padding:8px 10px;
      background:#fef3c7;
      border:1px solid #facc15;
      color:#854d0e;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .alert-item span.count {
      font-weight:700;
    }

    .trend-bar {
      margin-top:14px;
      background:#f3f4f6;
      border-radius:999px;
      height:10px;
      overflow:hidden;
    }

    .trend-inner {
      height:100%;
      width:65%;
      background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);
    }

    .role-select {
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:0.85rem;
    }

    .role-select select {
      padding:4px 8px;
      border-radius:6px;
      border:1px solid #d1d5db;
      font-size:0.85rem;
    }

    /* Override manager-ui header */
  .main-header {
    background-color: #ffffff !important; 
    color: #0f172a; 
    border-bottom: 1px solid #e5e7eb;
  }

  .main-header img.full-logo {
    filter: none; /* keep original logo colors */
  }

  .name-role p {
    color: #0f172a !important;
  }

  .user img {
    border: 2px solid #e5e7eb;
  }
  </style>
</head>
<body>
<header class="main-header" style="justify-content:space-between; padding:12px 20px; background:#0b1120; color:#f9fafb;">
  <div style="display:flex; align-items:center; gap:12px;">
    <img src="./images/full-logo.png" alt="SyncFinance Logo" class="full-logo" style="height:36px;">
    
  </div>
  <div class="user" style="display:flex; align-items:center; gap:8px;">
    <img src="./images/user-profile.png" alt="User" style="width:36px; height:36px; border-radius:999px;">
    <div class="name-role">
      <p id="dashUserName" style="margin:0; font-weight:600;">Sample User</p>
      <p id="dashUserRole" style="margin:0; font-size:12px; opacity:0.8;">Role</p>
    </div>
  </div>
</header>

<main class="dash-page">
  <div class="dash-layout">
    <!-- Left: Ratios -->
    <section class="dash-card">
      <h1>Key Financial Ratios</h1>
      <p class="dash-subtitle">
        High-level health indicators calculated from your financial statements. Colors reflect typical textbook ranges.
      </p>

      <div class="ratio-grid" id="ratioGrid">
        <!-- cards filled by JS -->
      </div>

      <div class="trend-bar">
        <div class="trend-inner"></div>
      </div>
      <p class="ratio-note">
        This dashboard is front-end only for Sprint 5. In a full implementation, ratios would be calculated from the
        saved financial statements generated on the Financial Reports page.
      </p>
    </section>

    <!-- Right: Role menu + alerts -->
    <aside class="dash-card">
      <div class="role-select">
        <span>View dashboard as:</span>
        <select id="roleSelect">
          <option value="admin">Administrator</option>
          <option value="manager" selected>Manager</option>
          <option value="accountant">Accountant</option>
        </select>
      </div>

      <h2>Quick Actions</h2>
      <div class="menu-links" id="menuLinks">
        <!-- links set by role -->
      </div>

      <h2 style="margin-top:18px;">Important Messages</h2>
      <ul class="alerts-list" id="alertsList">
        <!-- alerts from JS -->
      </ul>
    </aside>
  </div>
</main>

<script>
  // ---- Mock ratio data for the dashboard ----
  const ratioData = {
    currentRatio: 2.1,
    quickRatio: 1.4,
    debtToEquity: 1.8,
    profitMargin: 0.11 // 11%
  };

  // Basic textbook-style thresholds
  function classifyCurrentRatio(v) {
    if (v < 1) return "bad";
    if (v < 2) return "warning";
    return "good";
  }
  function classifyQuickRatio(v) {
    if (v < 1) return "bad";
    if (v < 1.5) return "warning";
    return "good";
  }
  function classifyDebtToEquity(v) {
    if (v > 2) return "bad";
    if (v > 1) return "warning";
    return "good";
  }
  function classifyProfitMargin(v) {
    if (v < 0.05) return "bad";
    if (v < 0.10) return "warning";
    return "good";
  }

  function tagClass(kind) {
    switch (kind) {
      case "good": return "ratio-good";
      case "warning": return "ratio-warning";
      default: return "ratio-bad";
    }
  }

  function buildRatioCards() {
    const grid = document.getElementById("ratioGrid");
    grid.innerHTML = "";

    const cards = [];

    const crKind = classifyCurrentRatio(ratioData.currentRatio);
    cards.push({
      label: "Current Ratio",
      value: ratioData.currentRatio.toFixed(2),
      tag: crKind,
      note: "Measures short-term liquidity (current assets รท current liabilities)."
    });

    const qrKind = classifyQuickRatio(ratioData.quickRatio);
    cards.push({
      label: "Quick Ratio",
      value: ratioData.quickRatio.toFixed(2),
      tag: qrKind,
      note: "Stricter liquidity test using quick assets only."
    });

    const deKind = classifyDebtToEquity(ratioData.debtToEquity);
    cards.push({
      label: "Debt-to-Equity",
      value: ratioData.debtToEquity.toFixed(2),
      tag: deKind,
      note: "How heavily the company relies on debt vs. equity."
    });

    const pmKind = classifyProfitMargin(ratioData.profitMargin);
    cards.push({
      label: "Profit Margin",
      value: (ratioData.profitMargin * 100).toFixed(1) + "%",
      tag: pmKind,
      note: "Portion of revenue that turns into profit."
    });

    cards.forEach(c => {
      const div = document.createElement("div");
      div.className = "ratio-card";
      div.innerHTML = `
        <div class="ratio-label">${c.label}</div>
        <div class="ratio-value">${c.value}</div>
        <span class="ratio-tag ${tagClass(c.tag)}">
          ${c.tag === "good" ? "Good" : c.tag === "warning" ? "Borderline" : "Needs review"}
        </span>
        <div class="ratio-note">${c.note}</div>
      `;
      grid.appendChild(div);
    });
  }

  // ---- Role-based menu + alerts ----
  const roleSelect = document.getElementById("roleSelect");
  const menuLinks = document.getElementById("menuLinks");
  const alertsList = document.getElementById("alertsList");
  const userNameEl = document.getElementById("dashUserName");
  const userRoleEl = document.getElementById("dashUserRole");

  const roleProfiles = {
    admin: { name: "Jane Doe", label: "Administrator" },
    manager: { name: "Mark Green", label: "Manager" },
    accountant: { name: "Alex Rivera", label: "Accountant" }
  };

  function buildMenu(role) {
    menuLinks.innerHTML = "";
    alertsList.innerHTML = "";

    const profile = roleProfiles[role];
    userNameEl.textContent = profile.name;
    userRoleEl.textContent = profile.label;

    const links = [];

    if (role === "admin") {
      links.push({ href: "admin.html", label: "Admin Home", primary: true });
      links.push({ href: "admin-client-list.html", label: "Client Accounts" });
      links.push({ href: "add-user.html", label: "Add User" });
      links.push({ href: "financial-reports.html", label: "Financial Reports (view-only)" });
    } else if (role === "manager") {
      links.push({ href: "manager.html", label: "Manager Home", primary: true });
      links.push({ href: "journal.html", label: "Adjusting Entries" });
      links.push({ href: "financial-reports.html", label: "Financial Reports" });
      links.push({ href: "ledger.html", label: "Ledger (per account)" });
    } else if (role === "accountant") {
      links.push({ href: "accountant.html", label: "Accountant Home", primary: true });
      links.push({ href: "journal-entry.html", label: "Create Journal Entry" });
      links.push({ href: "journal.html", label: "View All Journal Entries" });
    }

    links.forEach(l => {
      const a = document.createElement("a");
      a.href = l.href;
      a.textContent = l.label;
      if (l.primary) a.classList.add("primary-link");
      menuLinks.appendChild(a);
    });

    // Mock alert counts (front-end only)
    let alertItems = [];
    if (role === "manager") {
      alertItems = [
        { text: "Adjusting journal entries pending approval", count: 3 },
        { text: "New event logs for high-risk accounts", count: 1 }
      ];
    } else if (role === "accountant") {
      alertItems = [
        { text: "Entries returned with comments", count: 1 },
        { text: "Period closing deadline approaching", count: 1 }
      ];
    } else if (role === "admin") {
      alertItems = [
        { text: "New user access requests", count: 2 },
        { text: "Password resets requested", count: 4 }
      ];
    }

    alertItems.forEach(item => {
      const li = document.createElement("li");
      li.className = "alert-item";
      li.innerHTML = `
        <span>${item.text}</span>
        <span class="count">${item.count}</span>
      `;
      alertsList.appendChild(li);
    });
  }

  roleSelect.addEventListener("change", () => {
    buildMenu(roleSelect.value);
  });

  // Initial render
  buildRatioCards();
  buildMenu(roleSelect.value);
</script>
</body>
</html>
